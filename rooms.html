<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@0,100..900;1,100..900&family=Old+Standard+TT:ital,wght@0,400;0,700;1,400&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Oswald:wght@200..700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assets/styles/styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body class="rooms">
    <article class="rooms__page-header">
      <h6 class="rooms__page-header__subtitle">The ultimate luxury</h6>
      <h4 class="rooms__page-header__title">Ultimate<br />Room</h4>
      <nav class="rooms__page-header__navbar">
        <li class="page-header__navbar__pages">
          <ul class="page">
            Home
          </ul>
          <ul class="page page--divisor">
            |
          </ul>
          <ul class="page page--active">
            Rooms
          </ul>
        </li>
      </nav>
    </article>
    <section id="pagination" class="rooms__slider">
      <article class="rooms__slider__room-card">
        <img class="rooms__slider__room-card__image" data-field="image" src="" alt="" />
        <li class="rooms__slider__room-card__features">
          <ul class="feature feature">
            <img
              src="./assets/images/8725460_bed_icon 1.svg"
              alt="includes-bed"
            />
          </ul>
          <ul class="feature feature--included">
            <img
              src="./assets/images/925808_wifi_icon 1.svg"
              alt="includes-bed"
            />
          </ul>
          <ul class="feature feature--included">
            <img
              src="./assets/images/4920723_automobile_car_transport_transportation_travel_icon 1.svg"
              alt="includes-bed"
            />
          </ul>
          <ul class="feature feature">
            <img
              src="./assets/images/384878_cold_new year_snowflake_wheather_winter_icon 1.svg"
              alt="includes-bed"
            />
          </ul>
          <ul class="feature feature">
            <img
              src="./assets/images/9042522_gym_icon 1.svg"
              alt="includes-bed"
            />
          </ul>
          <ul class="feature feature--included">
            <img
              src="./assets/images/9081473_smoking_no_icon 1.svg"
              alt="includes-bed"
            />
          </ul>
          <ul class="feature feature">
            <img
              src="./assets/images/6623006_cocktail_drink_holidays_summer_vacation_icon 1.svg"
              alt="includes-bed"
            />
          </ul>
        </li>
        <h4 class="rooms__slider__room-card__title" data-field="title"></h4>
        <h6 class="rooms__slider__room-card__subtitle" data-field="subtitle"></h6>
        <span class="rooms__slider__room-card__price" data-field="price"></span>
        <button class="rooms__slider__room-card__button">Booking Now</button>
      </article>
    </section>
    <script>
      class Pagination {
        constructor(perPage, items, containerId) {
          this._perPage = perPage;
          this._numPages =
            Math.floor(items.length / perPage) +
            (!!(items.length % perPage) ? 1 : 0);
          this._currentPage = 1;
          this._items = items;
          this._containerId = containerId;
          this._containerHTMLElement = document.getElementById(containerId);
          this._itemHTMLTemplate = document.getElementById(containerId).firstElementChild;
          
          this.init();
        }

        init() {
          this.createNavBar();
        }

        isURL(string) {
          let isValid = true
          try {
            new URL(string);
          } catch (error) {
            isValid = false;
          }

          return isValid;
        }

        fetchItemHTMLTemplate(itemObject) {
          let itemHTMLElement = this._itemHTMLTemplate.cloneNode(true);

          itemHTMLElement.querySelectorAll("[data-field]")
            .forEach((fieldHTMLElement) => {
              const fieldName = fieldHTMLElement.dataset.field;
              if (fieldHTMLElement.tagName === "IMG" && fieldHTMLElement.hasAttribute("src"))
                fieldHTMLElement.src = (this.isURL(itemObject[fieldName]) && itemObject[fieldName]) || "";
              else
                fieldHTMLElement.innerHTML = itemObject[fieldHTMLElement.dataset.field] || "";
            });

          return itemHTMLElement;
        }

        loadNewItems() {
          const showItems = this._items.slice(
            this._perPage * (this._currentPage - 1),
            this._perPage * this._currentPage
          );
          const showHTMLElements = showItems.map((itemObject, index) => {
            const itemHTMLElement = this.fetchItemHTMLTemplate(itemObject);
            itemHTMLElement.id = index;
            return itemHTMLElement;
          });

          showHTMLElements.forEach((htmlElement, index) => {
            this._containerHTMLElement.appendChild(htmlElement.cloneNode(true));
          });
        }

        removeOldItems() {
          const removeHTMLElements = [...this._containerHTMLElement.getElementsByTagName("article"),];
          for (const htmlElement of removeHTMLElements) {
            this._containerHTMLElement.removeChild(htmlElement);
          }
        }

        createNavBar() {
          this._navbar = document.createElement("ul");
          this._navbar.classList.add(this._containerId);
          const buttonsLimit = this._numPages >= 5 ? 7 : this._numPages + 2
          Array(buttonsLimit)
            .fill()
            .forEach((item, index) => {
              const listItem = document.createElement("li");
              listItem.dataset.ref = index;
              listItem.classList.add("page");

              if (index === 0) {
                listItem.innerHTML = ""
                listItem.style.backgroundImage = `url("./assets/images/Double_Chevron_Left.svg")`
                listItem.classList.add("change-by-one")
              } else if (index === buttonsLimit - 1) {
                listItem.innerHTML = ""
                listItem.style.backgroundImage = `url("./assets/images/Double_Chevron_Right.svg")`
                listItem.classList.add("change-by-one")
              } else if (index === 1) {
                listItem.innerHTML = index 
                listItem.dataset.page = index
              } else if (index === buttonsLimit - 2) {
                listItem.innerHTML = this._numPages
                listItem.dataset.page = this._numPages
              } else if (index <= Math.floor(buttonsLimit / 2)) {
                listItem.innerHTML = index 
                listItem.dataset.page = index
              } else if (this._numPages - index < 2) {
                listItem.innerHTML = index
                listItem.dataset.page = index
              } else {
                listItem.innerHTML = "..."
              }

              if (index === 1)
                listItem.classList.add("page--selected")

              this._navbar.append(listItem);
            });
          this._containerHTMLElement.appendChild(this._navbar);

          this.startListening();
        }

        startListening() {
          const handleClick = (event) => {
            const pages = document.querySelectorAll(`.${this._containerId} .page`);

            if (!event || event.target.dataset.ref == 1) 
              this._currentPage = 1 
            else if (event.target.dataset.ref == 0 && this._currentPage > 1)
              this._currentPage = this._currentPage - 1
            else if (event.target.dataset.ref == pages.length - 1 && this._currentPage < this._numPages)
              this._currentPage = this._currentPage + 1
            else if(event.target.dataset.page)
              this._currentPage = Number(event.target.dataset.page)

            pages.forEach((page, index) => { 
              page.classList.remove("not-allowed")

              if (index == 0 || index == pages.length - 1){
                page = page
              } else if (index === 1) {
                page.innerHTML = index
                page.dataset.page = index
              } else if (index === pages.length - 2){
                page.innerHTML = this._numPages
                page.dataset.page = this._numPages
              } else if (this._numPages <= 5 ){
                page.innerHTML = index
                page.dataset.page = index
              } else if (index === 2 && this._currentPage - 1 > 2) {
                page.innerHTML = "..."
                page.removeAttribute("data-page")
                page.classList.add("not-allowed")
              } else if (index === 2) {
                page.innerHTML = index
                page.dataset.page = index
              } else if (index === pages.length - 3 && this._numPages - this._currentPage > 2) {
                page.innerHTML = "..."
                page.removeAttribute("data-page")
                page.classList.add("not-allowed")
              } else if (index === pages.length - 3) {
                page.innerHTML = this._numPages - 1
                page.dataset.page = this._numPages - 1
              } else if (index === Math.floor(pages.length / 2) && (this._currentPage - 1 >= 2 && this._numPages - this._currentPage >= 2)) {
                page.innerHTML = this._currentPage
                page.dataset.page = this._currentPage
              } else if (index === Math.floor(pages.length / 2) && this._currentPage < Math.floor(pages.length / 2)) {
                page.innerHTML = Math.floor(pages.length / 2)
                page.dataset.page = Math.floor(pages.length / 2)
              } else if (index === Math.floor(pages.length / 2) && this._numPages - this._currentPage < Math.floor(pages.length / 2)) {
                page.innerHTML = this._numPages - 2
                page.dataset.page = this._numPages - 2
              }

              if (page.innerHTML == this._currentPage)
                page.classList.add("page--selected") 
              else 
                page.classList.remove("page--selected")                 
            });

            this.removeOldItems();

            this.loadNewItems();
          };

          handleClick();

          this._navbar.querySelectorAll("li").forEach((listItem) => {
            listItem.addEventListener("click", handleClick);
          });
        }

        stopListening() {
          this._navbar.querySelectorAll("li").forEach((listItem) => {
            listItem.replaceWith(listItem.cloneNode(true));
          });
        }
      }

      const rooms = [
        { 
          title: "Minimal Duplex Room", 
          subtitle: "Lorem ipsum dolor sit amet, consectetur adipi sicing elit, sed do eiusmod tempor.",
          price: "$345/Night"
        },
        { 
          title: "Minimal Duplex Room", 
          subtitle: "Lorem ipsum dolor sit amet, consectetur adipi sicing elit, sed do eiusmod tempor.",
          price: "$345/Night"
        },
        { 
          title: "Minimal Duplex Room", 
          subtitle: "Lorem ipsum dolor sit amet, consectetur adipi sicing elit, sed do eiusmod tempor.",
          price: "$345/Night"
        },
      ];
      const roomsPagination = new Pagination(2, rooms, "pagination");

    </script>
  </body>
</html>
